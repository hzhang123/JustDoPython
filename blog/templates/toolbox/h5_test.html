{% extends 'base.html' %}
{% from 'bootstrap/form.html' import render_form %}
{% from 'bootstrap/form.html' import render_field %}

{% block head %}
    <script>
        function vds1() {
            var _vds = _vds || [];
            window._vds = _vds;
            (function () {
                _vds.push(['setAccountId', '{{ env.accountId }}']);
                (function () {
                    var vds = document.createElement('script');
                    vds.type = 'text/javascript';
                    vds.async = true;
                    vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'assets.giocdn.com/vds.js';
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(vds, s);
                })();
            })();
            // _vds.push(['setUserId', '12131']);
        }

        function vds2() {
            !function (e, t, n, g, i) {
                e[i] = e[i] || function () {
                    (e[i].q = e[i].q || []).push(arguments)
                }, n = t.createElement("script"), tag = t.getElementsByTagName("script")[0], n.async = 1, n.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + g, tag.parentNode.insertBefore(n, tag)
            }(window, document, "script", "{{ env.vdsJs }}", "gio");
            gio('init', '{{ env.accountId }}', {});
            // gio('setUserId', '1234')
            gio('send');
        }

        vds2()
    </script>
    <script>
        // 集成代码
        (function (window, document, src) {
            // _vds 是 1.0版本无埋点，gio.q是2.0
            // 1.0 插入队尾，2.0插入队顶
            // Function.prototype.bind方法ie8 不支持
            function bind(fn, obj) {
                return function () {
                    fn.apply(obj, (arguments.length === 1 ? [arguments[0]] : Array.apply(null, arguments)))
                }
            }

            var gio_q = !!window.gio ? bind(window.gio.q.unshift, window.gio.q) : bind(window._vds.push, window._vds);
            var key = "growingio-sdk";
            window[key] = {
                pendingEvents: []
            }
            gio_q(['setListener', function (event) {
                if (!!window[key] && !!window[key].eventMessageQueue) {
                    window[key].eventMessageQueue.feed(event)
                } else if (window[key].pendingEvents.length <= 200) {
                    window[key].pendingEvents.push(event)
                }
            }])

            var script = document.createElement("script");
            var scriptTags = document.getElementsByTagName("script");
            script.async = 1;
            script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + src;
            var tag = scriptTags[scriptTags.length - 1];
            tag.parentNode.insertBefore(script, tag);
        })(window, document, "{{ env.h5Js }}"); // 通过h5Js设置不同环境或者web、h5的集成
    </script>

    {{ render_static('js', '/h5_test/js/main.js', local = True) }}

{% endblock %}

{% block content %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-10">
                <div class="alert alert-primary" role="alert">
                    产品线： {{ args.product }}， 平台： {{ args.type }}，
                    环境： {{ args.h5Env }}， 无埋点版本：{{ args.h5Version }}
                </div>
            </div>
        </div>
    </div>
    <form>
        <div class="form-group">
            <label for="exampleFormControlInput1">你想弹几次？</label>
            <input type="text" class="form-control" id='message-display-times' aria-describedby="emailHelp"
                   placeholder="展示次数">
        </div>
        <div class="form-group">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id='randomId' value='on'>
                <label class="form-check-label" for="randomId">
                    随机生成ID
                </label>
            </div>
        </div>
        <div class="form-group">
            <label for="exampleFormControlInput1">需要展示的弹窗(id)</label>
            <input type="text" class="form-control" id='message-display-times' placeholder="弹窗id">
        </div>
        <div class="form-group">
            <label for="exampleFormControlInput1">需要展示的弹窗</label>
            <textarea name='message' class="form-control" id='message-textarea' placeholder="需要展示的弹窗"
                      onchange="handleMessageChange()"></textarea>
        </div>
        <div class="form-group">
            <div class="input-group mb-3">
                <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
                    <button type="button" class="btn btn-primary"
                            onclick="$$.renderMessages({ position: 'center'})">中间弹窗
                    </button>
                    <button type="button" class="btn btn-secondary"
                            onclick="$$.renderMessages({ position: 'lb'})">左下角弹窗
                    </button>
                    <button type="button" class="btn btn-success" onclick="$$.renderH5()">H5弹窗</button>
                    <button type="button" class="btn btn-info"
                            onclick="$$.renderMessages({ position: 'lb'}); $$.renderMessages({ position: 'center'})">
                        同时显示
                    </button>
                </div>
            </div>

            <div class="input-group mb-3">
                <div class="btn-group btn-group-sm" role="group" aria-label="Basic example1">

                    <button type="button" class="btn btn-primary" onclick="$$.clearAllMessages()">清除所有</button>
                    <br/>
                    <button type="button" class="btn btn-primary" onclick="$$.clearCookie(); ">清空Cookie</button>
                    <button type="button" class="btn btn-primary" onclick="$$.clearLocalStorage(); ">
                        清空Localstorage
                    </button>
                </div>
            </div>


            <div class="input-group mb-3">
                <input id="username-input" type="text" class="form-control" placeholder="请输入登录用户名"
                       aria-label="请输入登录用户名" aria-describedby="basic-addon2" value="zhangsan">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button"
                            onclick="gio('setUserId', $('#username-input').val()); location.reload(true);">切换登录用户
                    </button>
                    <button class="btn btn-outline-secondary" type="button"
                            onclick="gio('clearUserId'); location.reload(true);">清除登录用户
                    </button>
                </div>
            </div>

            <div class="btn-group btn-group-sm" role="group" aria-label="Basic example2">
                <button type="button" class="btn btn-dark"
                        onclick="gio('track', 'payOrderSuccess', {'org_name':'GrowingIO','payAmount_var':1000}); ">
                    点击购买
                </button>
                <a href="http://test-browser.growingio.com/push/saas/h6.html" class="btn href-primary" target="_blank"
                   onclick="gio('track', 'goodsClick', {'org_name':'hrc'}); ">点击跳转</a>
            </div>

        </div>

    </form>
    <div class="col-md-10" id='popups'>
        <script>
            $$.renderMessagesToDom('popups', 'popup_1');
            $$.renderMessagesToDom('popups', 'popup_2');
            $$.renderMessagesToDom('popups', 'popup_3');
        </script>
    </div>
{% endblock %}
